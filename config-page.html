<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LedDimmer config page</title>
	<base href="http://leddimmer.fritz.box">
	<script>
		function setCurrent(value) {
			const headers = {'Content-Type': 'text/plain'};
			fetch(
				'/current', {
				headers,
				method: 'POST',
				body: value
			});
		}

		async function getAndWriteTime() {
			const time = await (await fetch('time')).text();
			document.querySelector('#currentTime').textContent = time;
		}

		function forceTimeUpdate() {
			const time = fetch('time/update');
			getAndWriteTime();
		}

		async function getAndWriteConfig() {
			const config = await (await fetch('config/0')).json();
			document.querySelector('[name=enabled]').checked = config.enabled;
			document.querySelector('[name=startTime]').value = config.startTime;
			document.querySelector('[name=endTime]').value = config.endTime;
			document.querySelector('[name=percentage]').value = config.percentage;
			console.log(config);
		}

		getAndWriteTime();
		setInterval(getAndWriteTime, 10000);
		getAndWriteConfig();
	</script>
</head>
<body>
<h1>LedDimmer</h1>

<fieldset>
	<legend>Presets</legend>
	<button onclick="setCurrent(100)">An (100%)</button>
	<button onclick="setCurrent(70)">An (70%)</button>
	<button onclick="setCurrent(70)">An (30%)</button>
	<button onclick="setCurrent(0)">Aus (0%)</button>
</fieldset>

<fieldset>
	<legend>Datum und Uhrzeit</legend>
	<span id="currentTime">Lade...</span> (UTC)
	<button onclick="forceTimeUpdate()">Force Update</button>
</fieldset>

<fieldset>
	<legend>Automatisches ein- und ausschalten Config 1</legend>
	<form action="http://leddimmer.fritz.box/config/0" method="POST">
		<label>Aktiviert <input type="checkbox" name="enabled"></label>
		<label>Anschalten um <input type="time" name="startTime" required></label>
		<label>Abschalten um <input type="time" name="endTime" required></label>
		<label>Wert <input type="number" min="0" max="100" name="percentage" required></label>
		<button type="submit">Speichern</button>
	</form>
</fieldset>


</body>
</html>